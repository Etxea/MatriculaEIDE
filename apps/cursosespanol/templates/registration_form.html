{% extends "site_base.html"%}
{% load i18n %}
{% load bootstrap_tags %}


{% block body %}
    <script>
	/* Funcion que comprueba si el examen es KET y si lo es oculta el texto legal de la foto */
	function comprobar_aceptacion() {
		console.log("Han hecho click en el check de las condiciones");
		//Comprobamos si es obligatoria la foto
		examen = $('#id_exam').find(":selected").text();
		if (examen.match('KET')) {
		    console.log("No es obligatoria la foto porque es un examen KET"); 
		    no_foto_obligatoria=true;
		}
		else {
		    console.log("Si es obligatoria la foto"); 
		    no_foto_obligatoria=false;
		}
                acepta = false ;
                if ($("#id_accept_conditions").is(":checked"))
		{
		    console.log("Condiciones generales aceptadas");
		    if ( $("#id_accept_photo_conditions").is(":checked") || no_foto_obligatoria ) 
		    {
			acepta = true;
		    }
		}
		if (acepta) {
		    console.log("Dice que las acepta");
		    $("#send_form").prop('disabled', false);
		    console.log("Ocultamos el aviso");
		    $("#aviso_condiciones").hide();
		}
                else {
		    //Deshabilitamos el envio hasta que acepten las condiciones
                    console.log("Dice que NO las acepta");
                    $("#send_form").prop('disabled', true);
		    console.log("Mostramos el aviso");
		    $("#aviso_condiciones").show();
                }
            }
        $(document).ready(function() {
	    $("#id_birth_date").datepicker({format: "dd-mm-yyyy",weekStart: 1});

	    $("#normativa_general").hide();
            //Comprobamos si se puede enviar
	    comprobar_aceptacion();
            $("#id_accept_conditions").change(comprobar_aceptacion);
        });
    </script>

<div>
</div>
    <form action="{% url cambridge_nueva %}" method="post" class="form-horizontal" >{% csrf_token %}	
<div class="row">
    <div class="span14">

	{{ form|as_bootstrap }}
    </div> 
</div>

<div class="row">
    <div class="span14">
	{% include "legal.html" %}
	<div>
	    ¿Aceptas las condiciones? <input type="checkbox" id="id_accept_conditions" name="accept_conditions">
        </div>
	
    </div> 
</div>

<div class="row">
    <div class="span12">    
	<div class="well" id="aviso_condiciones">
	    {% trans "<b>¡Atención!.</b> Todavía no has aceptado las condiciones. Si no aceptas las condiciones generales y las condiciones de la toma de foto no podrás enviar la matrícula." %}
	</div>
	<input id="send_form" class="btn btn-primary pull-right" type="submit" value="{% trans 'Submit' %}" />
    </div> 
</div> 
</form>
{% endblock %}
